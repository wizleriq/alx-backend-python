#!/bin/bash

# Script: kubctl-0x02
# Purpose: Perform Blue-Green Deployment for Django Messaging App

set -e  # Exit on error

echo "ğŸš€ Deploying Blue (current) version..."
kubectl apply -f blue_deployment.yaml

echo "ğŸš€ Deploying Green (new) version..."
kubectl apply -f green_deployment.yaml

echo "ğŸ” Checking deployment status..."
kubectl get deployments

echo "ğŸ“¦ Checking pods..."
kubectl get pods -l app=django-messaging

echo "ğŸ“œ Checking logs for the new (green) deployment..."
GREEN_POD=$(kubectl get pods -l version=green -o jsonpath="{.items[0].metadata.name}")
kubectl logs "$GREEN_POD"

echo "ğŸ” Applying service to route traffic..."
kubectl apply -f kubeservice.yaml

echo "âœ… Blue-Green deployment complete!"
echo "â„¹ï¸  To switch traffic, edit kubeservice.yaml and change selector version to 'green'."
